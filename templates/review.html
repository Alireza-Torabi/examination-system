{% extends "layout.html" %}
{% block content %}
<div class="toolbar">
  <div>
    <p class="hint">Exam: {{ attempt.exam.title }}</p>
    <h2>Review answers</h2>
  </div>
  <div class="pill">Time left: {{ time_left_seconds }}s</div>
</div>

<div class="card">
  {% for question in questions %}
    {% set q_rtl = is_rtl(question.text|striptags) %}
    <div class="review-item" dir="{{ 'rtl' if q_rtl else 'ltr' }}">
      <p class="question-text">{{ loop.index }}. {{ question.text|normalize_imgs|safe }}</p>
      {% set qimg = question.image_path|img_url %}
      {% if qimg %}
        <div class="question-image"><img src="{{ qimg }}" alt="Question image"></div>
      {% endif %}
      <ul class="plain" dir="{{ 'rtl' if q_rtl else 'ltr' }}">
        {% set letters = ['A','B','C','D','E','F'] %}
        {% for choice in question.choices %}
          <li>
            {% set checked = choice.id in (answers_map.get(question.id) or []) %}
            {{ letters[loop.index0] }}. {{ "[x]" if checked else "[ ]" }} {{ choice.text }}
            {% if choice.image_path %}
              <img src="{{ url_for('static', filename=choice.image_path) }}" alt="Option image" class="choice-image inline">
            {% endif %}
          </li>
        {% endfor %}
      </ul>
      <a class="ghost" href="{{ url_for('student.show_question', attempt_id=attempt.id, index=loop.index) }}">Edit</a>
      <hr>
    </div>
  {% endfor %}
  <form method="post" action="{{ url_for('student.submit_attempt', attempt_id=attempt.id) }}">
    <button type="submit">Submit exam</button>
  </form>
</div>
{% endblock %}
