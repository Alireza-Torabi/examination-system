{% extends "layout.html" %}
{% block content %}
<div class="card printable">
  <div class="toolbar no-space">
    <div>
      <h2>Result: {{ attempt.exam.title }}</h2>
      <p class="hint">Started: {{ attempt.started_at }} | Submitted: {{ attempt.submitted_at }}</p>
    </div>
    <button onclick="window.print()">Print</button>
  </div>
  <p><strong>Score:</strong> {{ attempt.score_percent }}% ({{ attempt.num_correct }} / {{ attempt.num_questions }})</p>
  <h3>Your answers</h3>
  {% for question in questions %}
    {% set q_rtl = is_rtl(question.text) %}
    <div class="review-item" dir="{{ 'rtl' if q_rtl else 'ltr' }}">
      <p class="question-text">{{ loop.index }}. {{ question.text }}</p>
      {% if question.image_path %}
        <div class="question-image"><img src="{{ url_for('static', filename=question.image_path) }}" alt="Question image"></div>
      {% endif %}
      <ul class="plain" dir="{{ 'rtl' if q_rtl else 'ltr' }}">
        {% set selected = answers_map.get(question.id) or [] %}
        {% set letters = ['A','B','C','D','E','F'] %}
        {% for choice in question.choices %}
          {% set correct = choice.is_correct %}
          {% set chosen = choice.id in selected %}
          <li class="{% if correct %}correct{% elif chosen %}wrong{% else %}neutral{% endif %}">
            {{ letters[loop.index0] }}. {% if chosen %}(chosen){% elif selected|length == 0 %}<span class="hint red"><strong>(unanswered)</strong></span>{% else %}( ){% endif %} {{ choice.text }}
            {% if correct %}(correct){% endif %}
          </li>
        {% endfor %}
        {% if selected|length == 0 %}
          <li class="hint red"><strong>You did not answer this question.</strong></li>
        {% endif %}
      </ul>
      {% if question.reason %}
        <p class="hint">Reason: {{ question.reason }}</p>
      {% endif %}
    </div>
  {% endfor %}
</div>
{% endblock %}
